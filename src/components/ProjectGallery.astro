---
interface Props {
    coverImage: string;
    projectTitle: string;
    galleryImages: string[];
}

const { coverImage, projectTitle, galleryImages } = Astro.props;
const galleryId = `gallery-${projectTitle.toLowerCase().replace(/\s+/g, "-")}`;
---

<div
    class="relative w-full h-full group cursor-pointer"
    onclick={`document.getElementById('${galleryId}').showModal()`}
>
    <div
        class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-10 flex items-center justify-center"
    >
        <div class="bg-white/20 backdrop-blur-md p-4 rounded-full text-white">
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="32"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                ><path d="M15 3h6v6"></path><path d="M10 14 21 3"></path><path
                    d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"
                ></path></svg
            >
        </div>
        <span
            class="absolute mt-20 text-white font-bold tracking-wider text-sm opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-4 group-hover:translate-y-0"
            >VER GALER√çA</span
        >
    </div>
    <img
        src={coverImage}
        alt={`Cover of ${projectTitle}`}
        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
    />
</div>

<dialog
    id={galleryId}
    class="backdrop:bg-black/90 bg-transparent w-full h-full max-w-full max-h-full m-0 p-0 border-none outline-none z-[100] open:flex open:items-center open:justify-center"
>
    <div class="relative w-full h-full flex items-center justify-center p-4">
        <!-- Close Button -->
        <form method="dialog" class="absolute top-4 right-4 z-50">
            <button
                class="text-white hover:text-primary transition-colors p-2 bg-black/50 rounded-full"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="32"
                    height="32"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    ><path d="M18 6 6 18"></path><path d="M6 6 18 18"
                    ></path></svg
                >
            </button>
        </form>

        <!-- Carousel Container -->
        <div
            class="carousel-container relative w-full max-w-5xl aspect-video bg-black rounded-lg overflow-hidden shadow-2xl border border-white/10"
        >
            {
                galleryImages.map((img, index) => (
                    <div
                        class={`carousel-slide absolute inset-0 transition-opacity duration-500 flex items-center justify-center bg-[#0a0a0a] ${index === 0 ? "opacity-100 z-10" : "opacity-0 z-0"}`}
                        data-index={index}
                    >
                        <img
                            src={img}
                            alt={`${projectTitle} screenshot ${index + 1}`}
                            class="max-w-full max-h-full object-contain"
                        />
                    </div>
                ))
            }

            <!-- Navigation -->
            <button
                class="prev-btn absolute left-4 top-1/2 -translate-y-1/2 bg-primary/90 hover:bg-primary text-white p-3 rounded-full transition-all z-20 shadow-lg hover:scale-110 backdrop-blur-sm border border-white/20"
                aria-label="Previous image"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="32"
                    height="32"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="3"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    ><path d="m15 18-6-6 6-6"></path></svg
                >
            </button>
            <button
                class="next-btn absolute right-4 top-1/2 -translate-y-1/2 bg-primary/90 hover:bg-primary text-white p-3 rounded-full transition-all z-20 shadow-lg hover:scale-110 backdrop-blur-sm border border-white/20"
                aria-label="Next image"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="32"
                    height="32"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="3"
                    stroke-linecap="round"
                    stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg
                >
            </button>

            <!-- Indicators -->
            <div
                class="absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-3 z-20 bg-black/50 backdrop-blur-sm px-4 py-3 rounded-full border border-white/10"
            >
                {
                    galleryImages.map((_, index) => (
                        <button
                            class={`indicator w-3 h-3 rounded-full transition-all hover:scale-125 ${index === 0 ? "bg-primary scale-125 shadow-lg shadow-primary/50" : "bg-white/50 hover:bg-white"}`}
                            data-index={index}
                            aria-label={`Go to slide ${index + 1}`}
                        />
                    ))
                }
            </div>
        </div>
    </div>
</dialog>

<script define:vars={{ galleryId }}>
    const dialog = document.getElementById(galleryId);
    const slides = dialog.querySelectorAll(".carousel-slide");
    const indicators = dialog.querySelectorAll(".indicator");
    const prevBtn = dialog.querySelector(".prev-btn");
    const nextBtn = dialog.querySelector(".next-btn");
    let currentIndex = 0;

    function showSlide(index) {
        slides.forEach((slide) => {
            slide.style.opacity = "0";
            slide.style.zIndex = "0";
        });
        indicators.forEach((ind) => {
            ind.classList.remove("bg-primary", "scale-125", "shadow-lg", "shadow-primary/50");
            ind.classList.add("bg-white/50");
        });

        slides[index].style.opacity = "1";
        slides[index].style.zIndex = "10";
        indicators[index].classList.remove("bg-white/50");
        indicators[index].classList.add("bg-primary", "scale-125", "shadow-lg", "shadow-primary/50");
        currentIndex = index;
    }

    function nextSlide() {
        let newIndex = (currentIndex + 1) % slides.length;
        showSlide(newIndex);
    }

    function prevSlide() {
        let newIndex = (currentIndex - 1 + slides.length) % slides.length;
        showSlide(newIndex);
    }

    nextBtn?.addEventListener("click", (e) => {
        e.stopPropagation();
        nextSlide();
    });

    prevBtn?.addEventListener("click", (e) => {
        e.stopPropagation();
        prevSlide();
    });

    indicators.forEach((ind) => {
        ind.addEventListener("click", (e) => {
            e.stopPropagation();
            const idx = parseInt(e.target.dataset.index);
            showSlide(idx);
        });
    });

    // Close on backdrop click
    dialog.addEventListener("click", (e) => {
        if (e.target === dialog) {
            dialog.close();
        }
    });
</script>
